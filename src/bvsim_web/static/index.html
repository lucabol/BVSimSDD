<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>BVSim Web</title>
<link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
<link rel="alternate icon" type="image/png" href="/static/favicon.png" />
<link rel="shortcut icon" href="/static/favicon.svg" />
<style>
/* DESIGN TOKENS */
:root { --color-bg:#fafbfc; --color-surface:#ffffff; --color-border:#e2e8f0; --color-border-subtle:#cfd8e3; --color-brand:#0d47a1; --color-brand-accent:#1976d2; --color-brand-accent-grad:#1669c1; --color-text:#0d305f; --color-text-subtle:#4a5b6d; --color-danger:#b71c1c; --color-success:#1b5e20; --color-secondary:#546e7a; --color-purple:#6a1b9a; --radius-xs:3px; --radius-sm:6px; --radius-md:8px; --radius-lg:10px; --shadow-sm:0 1px 2px rgba(0,0,0,.04); --shadow-md:0 2px 6px rgba(0,0,0,.08); --transition-fast:120ms cubic-bezier(.4,0,.2,1); --font-size-btn:.7rem; }
body { font-family:system-ui,sans-serif; margin:0; padding:0; background:var(--color-bg); color:var(--color-text); }
header { background:var(--color-brand); color:#fff; padding:10px 18px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; }
header h1 { font-size:1.05rem; margin:0; font-weight:600; letter-spacing:.5px; display:flex; align-items:center; gap:.55rem; }
main { padding:14px 16px 32px; }
/* BUTTONS */
.btn { --_bg:var(--color-brand-accent); --_bg-hover:#115fa3; --_color:#fff; --_ring:var(--color-brand-accent); cursor:pointer; display:inline-flex; align-items:center; gap:.45em; border:1px solid transparent; background:var(--_bg); color:var(--_color); font-size:var(--font-size-btn); font-weight:600; letter-spacing:.5px; padding:6px 10px; border-radius:var(--radius-sm); line-height:1.1; position:relative; text-decoration:none; user-select:none; transition:background var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast); }
.btn:hover { background:var(--_bg-hover); }
.btn:focus { outline:2px solid var(--_ring); outline-offset:1px; }
.btn:active { transform:translateY(1px); }
.btn--secondary { --_bg:var(--color-secondary); --_bg-hover:#455a64; }
.btn--danger { --_bg:var(--color-danger); --_bg-hover:#8d1616; }
.btn--ghost { --_bg:rgba(255,255,255,.15); --_bg-hover:rgba(255,255,255,.28); border:1px solid #ffffff55; }
.btn--purple { --_bg:var(--color-purple); --_bg-hover:#5a1785; }
.btn--success { --_bg:var(--color-success); --_bg-hover:#124117; }
.btn--icon { padding:5px; width:30px; justify-content:center; }
.btn--sm { font-size:.62rem; padding:4px 8px; }
.btn-group { display:flex; gap:6px; flex-wrap:wrap; }
.icon { width:1em; height:1em; display:inline-block; flex:0 0 auto; }
.icon-inline { width:1.1em; height:1.1em; }
.sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0; }
/* CONTROLS LAYOUT */
#controls { display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); align-items:start; }
section.card { background:var(--color-surface); border:1px solid var(--color-border); border-radius:var(--radius-lg); padding:0; box-shadow:var(--shadow-sm); position:relative; overflow:hidden; }
section.card:hover { box-shadow:var(--shadow-md); }
section.card header.section-head { margin:0; padding:6px 10px 6px 12px; display:flex; align-items:center; justify-content:flex-start; background:linear-gradient(90deg,var(--color-brand) 0%,var(--color-brand-accent-grad) 100%); color:#fff; }
section.card header.section-head h2 { font-size:.75rem; font-weight:600; margin:0; letter-spacing:.5px; text-transform:uppercase; display:flex; align-items:center; gap:.4em; }
section.card .section-body { padding:10px 12px 12px; display:grid; gap:6px; }
section.card.collapsed .section-body { display:none; }
/* FORM CONTROLS */
label { display:block; font-size:.68rem; font-weight:600; color:#26435f; letter-spacing:.5px; }
input, select, textarea { width:100%; padding:5px 7px; font-size:.72rem; border:1px solid var(--color-border-subtle); border-radius:var(--radius-sm); background:#f8fafc; font-family:inherit; }
input:focus, select:focus, textarea:focus { outline:2px solid var(--color-brand-accent); background:#fff; }
/* UTIL FLEX */
.flex-row { display:flex; gap:6px; }
.flex-row > * { flex:1; }
.inline-group { display:flex; align-items:flex-end; gap:6px; flex-wrap:wrap; }
.inline-group label { flex:0 0 70px; margin-top:2px; }
.inline-group input { flex:1 1 80px; }
.examples-inline { display:flex; gap:4px; flex-wrap:wrap; align-items:flex-end; }
.examples-inline > div { display:flex; flex-direction:column; min-width:100px; flex:1 1 120px; }
#layoutOutputs { margin-top:18px; display:flex; flex-direction:column; gap:18px; }
@media (min-width:900px){ #layoutOutputs { flex-direction:row; align-items:stretch; } #confidenceChartSection { flex:2 1 0; } #textOutputSection { flex:1 1 0; max-width:520px; } }
@media (min-width:900px){ #confidenceChartSection, #textOutputSection { display:flex; flex-direction:column; } #confidenceChartSection > *, #textOutputSection > * { flex-shrink:0; } #output { flex:1 1 auto; } }
/* OUTPUT / CHART PANES */
#confidenceChartSection, #textOutputSection { background:var(--color-surface); border:1px solid var(--color-border); border-radius:10px; padding:12px 14px 16px; box-shadow:0 1px 3px rgba(0,0,0,.06); }
#confidenceChartSection h2, #textOutputSection h2 { margin:0 0 4px; font-size:.9rem; font-weight:600; color:#0d305f; display:flex; align-items:center; gap:8px; }
#confidenceChartSection p { margin:0 0 6px; }
#output { white-space:pre-wrap; font-family:ui-monospace, SFMono-Regular, Menlo, monospace; background:#0e1116; color:#d1d9e6; padding:10px 12px; border-radius:8px; max-height:420px; overflow:auto; font-size:.78rem; line-height:1.3; }
#output.collapsed { display:none; }
canvas#matchImpactChart { width:100%; }
footer { margin-top:28px; padding:16px 24px; font-size:.6rem; color:#5b6a7a; text-align:center; }
/* TABLES */
table.match-impact { width:100%; border-collapse:collapse; margin-top:4px; font-size:.72rem; }
table.match-impact thead { background:var(--color-brand); color:#fff; font-size:.74rem; }
table.match-impact th, table.match-impact td { padding:4px 6px; text-align:left; border:1px solid #d2dbe5; }
table.match-impact tbody tr:nth-child(even) { background:#f2f7fb; }
table.match-impact tbody tr:hover { background:#e8f1f9; }
table.match-impact .sig-pos { color:#0d652d; font-weight:600; }
table.match-impact .sig-neg { color:#b71c1c; font-weight:600; }
table.match-impact caption { caption-side:bottom; padding:6px 4px; font-size:.6rem; color:#607080; }
.status { font-size:.55rem; color:#4a5b6d; margin-top:2px; min-height:12px; }
.status .spinner { display:inline-block; width:9px; height:9px; border:2px solid var(--color-brand-accent); border-top-color:transparent; border-radius:50%; animation:spin .7s linear infinite; margin-right:3px; }
@keyframes spin { to { transform:rotate(360deg); } }
.muted { color:#6c8297; font-size:.55rem; }
.note { font-size:.55rem; color:#4a5b6d; margin-top:2px; }
/* RALLIES */
#ralliesContainer { margin-top:8px; display:none; overflow:auto; padding:4px 2px 2px; flex:1 1 auto; }
.rally-wrapper { border:1px solid #d4dde7; background:#f7fafc; border-radius:8px; padding:6px 8px 8px; margin:0 0 10px; box-shadow:0 1px 2px rgba(0,0,0,.04); }
.rally-header { display:flex; justify-content:space-between; align-items:center; font-size:.62rem; text-transform:uppercase; letter-spacing:.5px; margin-bottom:4px; color:#32506b; }
.rally-header .winner { font-weight:600; padding:2px 6px; border-radius:12px; background:var(--color-brand-accent); color:#fff; }
.rally-header .winner.team-B { background:#c62828; }
.rally-timeline { display:flex; align-items:stretch; flex-wrap:nowrap; overflow-x:auto; scrollbar-width:thin; }
.rally-step { position:relative; display:flex; flex-direction:column; justify-content:center; align-items:center; min-width:56px; padding:4px 6px 6px; border:1px solid #b5c6d8; border-radius:6px; background:#ffffff; font-size:.6rem; line-height:1.1; box-shadow:0 1px 1px rgba(0,0,0,.05); }
.rally-step.team-A { border-color:var(--color-brand-accent); background:#e3f2fd; }
.rally-step.team-B { border-color:#c62828; background:#ffebee; }
.rally-step:not(:first-child) { margin-left:14px; }
.rally-step:not(:first-child)::before { content:'\2192'; position:absolute; left:-12px; top:50%; transform:translateY(-50%); color:#546e7a; font-size:.7rem; }
.rally-step .act { font-weight:600; font-size:.58rem; text-align:center; }
.rally-step .qual { margin-top:2px; font-size:.5rem; padding:2px 4px; border-radius:10px; font-weight:500; letter-spacing:.5px; }
.qual.q-exc { background:#1b5e20; color:#fff; }
.qual.q-good { background:var(--color-brand-accent); color:#fff; }
.qual.q-ok { background:#607d8b; color:#fff; }
.qual.q-err { background:#b71c1c; color:#fff; }
.qual.q-ace { background:var(--color-purple); color:#fff; }
.rally-result { margin-left:10px; align-self:stretch; display:flex; align-items:center; font-size:.6rem; padding:4px 8px; border:1px dashed #607d8b; border-radius:6px; background:#f0f4f8; font-weight:600; white-space:nowrap; }
.rally-footer { margin-top:4px; font-size:.52rem; color:#5c6f80; display:flex; gap:6px; flex-wrap:wrap; }
#ralliesLegend { display:none; margin-top:8px; padding:4px 6px; background:#f1f5f9; border:1px solid #d4dde7; border-radius:6px; font-size:.55rem; line-height:1.3; }
#ralliesLegend span.swatch { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:4px; position:relative; top:1px; }
#ralliesLegend .teamA { background:var(--color-brand-accent); }
#ralliesLegend .teamB { background:#c62828; }
#ralliesLegend .exc { background:#1b5e20; }
#ralliesLegend .good { background:var(--color-brand-accent); }
#ralliesLegend .ok { background:#607d8b; }
#ralliesLegend .err { background:#b71c1c; }
#ralliesLegend .ace { background:var(--color-purple); }
/* Teams pane specific refinements (moved from stray top-of-file block) */
#teams.card { display:flex; flex-direction:column; }
#teams.card .section-body { flex:1 1 auto; display:flex; flex-direction:column; }
ul.team-list { list-style:none; padding:0; margin:4px 0 0; max-height:180px; overflow:auto; border:1px solid var(--color-border); border-radius:var(--radius-sm); background:var(--color-surface); }
ul.team-list li { display:flex; align-items:center; gap:6px; padding:6px 8px; font-size:.66rem; border-bottom:1px solid #edf1f5; position:relative; }
ul.team-list li:last-child { border-bottom:none; }
ul.team-list li .team-name { flex:1 1 auto; display:flex; align-items:center; gap:6px; font-weight:600; cursor:pointer; color:var(--color-text); }
ul.team-list li .team-name svg { width:14px; height:14px; color:var(--color-brand-accent); flex:0 0 auto; }
ul.team-list li .actions { display:flex; gap:4px; }
ul.team-list li:hover { background:#f1f5f9; }
#teams { min-height:300px; }
</style>
</head>
<body>
<header>
  <h1><svg class="icon-inline" aria-hidden="true"><use href="#icon-volleyball"/></svg> BVSim Web Interface</h1>
  <button id="globalToggleControls" class="btn btn--ghost btn--sm" type="button" onclick="toggleAllControls()"><svg class="icon" aria-hidden="true"><use href="#icon-collapse"/></svg><span class="btn-label">Collapse</span></button>
</header>
<main>
  <!-- SVG ICON SPRITE -->
  <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0;overflow:hidden" aria-hidden="true" focusable="false">
    <symbol id="icon-add" viewBox="0 0 24 24"><path fill="currentColor" d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol>
    <symbol id="icon-upload" viewBox="0 0 24 24"><path fill="currentColor" d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7Z"/></symbol>
    <symbol id="icon-play" viewBox="0 0 24 24"><path fill="currentColor" d="m8 5 11 7-11 7V5Z"/></symbol>
    <symbol id="icon-bolt" viewBox="0 0 24 24"><path fill="currentColor" d="M13 2 3 14h9l-1 8 10-12h-9l1-8Z"/></symbol>
    <symbol id="icon-target" viewBox="0 0 24 24"><path fill="currentColor" d="M12 20a8 8 0 1 1 8-8h2A10 10 0 1 0 4 12a10 10 0 0 0 16 7.32V14h-2v3.9A7.96 7.96 0 0 1 12 20Zm0-4a4 4 0 1 1 4-4h2a6 6 0 1 0-6 6v-2Z"/></symbol>
    <symbol id="icon-analyze" viewBox="0 0 24 24"><path fill="currentColor" d="M3 13h2v8H3v-8Zm4-6h2v14H7V7Zm4 3h2v11h-2V10Zm4-6h2v17h-2V4Zm4 9h2v8h-2v-8Z"/></symbol>
    <symbol id="icon-compare" viewBox="0 0 24 24"><path fill="currentColor" d="M10 3v2H6v12H4V5a2 2 0 0 1 2-2h4Zm8 4v12h2V7a2 2 0 0 0-2-2h-4v2h4ZM8 9h8v6H8V9Z"/></symbol>
    <symbol id="icon-rally" viewBox="0 0 24 24"><path fill="currentColor" d="M2 3h2l3.6 7.59L5.25 14A2 2 0 0 0 7 17h12v-2H7.42a.25.25 0 0 1-.24-.34L8.1 13h7.45a2 2 0 0 0 1.79-1.11L21 5H6.21L5.27 3H2Zm12 16a2 2 0 1 0 4 0h-4Z"/></symbol>
    <symbol id="icon-edit" viewBox="0 0 24 24"><path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25ZM20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82Z"/></symbol>
    <symbol id="icon-delete" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12ZM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4Z"/></symbol>
    <symbol id="icon-download" viewBox="0 0 24 24"><path fill="currentColor" d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7Z"/></symbol>
    <symbol id="icon-save" viewBox="0 0 24 24"><path fill="currentColor" d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4Zm0 16H5V5h10v4h4v10ZM12 12a3 3 0 0 0-3 3h2a1 1 0 0 1 2 0 1 1 0 0 1-1 1 2 2 0 0 0 0 4 3 3 0 0 0 3-3h-2a1 1 0 0 1-2 0 1 1 0 0 1 1-1 2 2 0 0 0 0-4Z"/></symbol>
    <symbol id="icon-format" viewBox="0 0 24 24"><path fill="currentColor" d="M3 5v4h2V7h4V5H3Zm6 6h6v2h-6v-2Zm8-2h4V5h-6v2h2v2Zm-2 8v-2h-6v2h6Zm-8-4v2H5v2H3v-4h4Zm10 4h4v-4h-2v2h-2v2Z"/></symbol>
    <symbol id="icon-close" viewBox="0 0 24 24"><path fill="currentColor" d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></symbol>
    <symbol id="icon-collapse" viewBox="0 0 24 24"><path fill="currentColor" d="M7 15h10l-5-6-5 6Z"/></symbol>
    <symbol id="icon-expand" viewBox="0 0 24 24"><path fill="currentColor" d="M7 9h10l-5 6-5-6Z"/></symbol>
    <symbol id="icon-volleyball" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a10 10 0 0 0-8.7 5.02L12 12.5V2Zm8.7 5.02A10 10 0 0 0 12 2v10.5l8.7-5.48ZM4 9.27V12a8 8 0 0 0 4.62 7.24l1.54-2.67L4 9.27Zm6.16 9.3A8 8 0 0 0 20 12V9.27l-9.38 5.43-.46.8Z"/></symbol>
  </svg>
  <div id="controls">
    <section id="teams" class="card">
      <header class="section-head">
        <h2>Teams</h2>
      </header>
      <div class="section-body">
        <div class="flex-row">
          <div>
            <label>New Team Name</label>
            <input id="newTeamName" placeholder="e.g. Elite Spikers" />
          </div>
          <div>
            <label>Base From</label>
            <select id="newTeamBase">
              <option value="__BASIC__">Basic Template</option>
              <option value="__ADVANCED__">Advanced Template</option>
            </select>
          </div>
        </div>
        <div class="btn-group">
          <button onclick="createTeamEnhanced()" class="btn"><svg class="icon" aria-hidden="true"><use href="#icon-add"/></svg><span>Add Team</span></button>
          <input type="file" id="uploadTeamFile" accept=".yaml,.yml" style="display:none;" />
          <button class="btn btn--secondary" onclick="triggerTeamUpload()"><svg class="icon" aria-hidden="true"><use href="#icon-upload"/></svg><span>Upload</span></button>
        </div>
        <label style="margin-top:4px">Teams</label>
        <ul class="team-list" id="teamList"></ul>
  <!-- Refresh button removed (auto-refresh via actions renders manually unnecessary) -->
      </div>
    </section>

    <section id="simulate" class="card">
      <header class="section-head">
        <h2>Simulate</h2>
      </header>
      <div class="section-body">
  <label>Team A</label>
  <select id="simTeamA"></select>
  <label>Team B</label>
  <select id="simTeamB"></select>
        <div class="flex-row">
          <div>
            <label>Points</label>
            <input id="simPoints" type="number" placeholder="default" />
          </div>
        </div>
        <div class="btn-group">
          <button onclick="simulate()" class="btn"><svg class="icon" aria-hidden="true"><use href="#icon-play"/></svg><span>Run</span></button>
          <button onclick="simulateQuick()" class="btn btn--secondary" title="Quick"><svg class="icon" aria-hidden="true"><use href="#icon-bolt"/></svg><span>Quick</span></button>
          <button onclick="simulateAccurate()" class="btn btn--purple" title="Accurate"><svg class="icon" aria-hidden="true"><use href="#icon-target"/></svg><span>Accurate</span></button>
        </div>
      </div>
    </section>

    <section id="skills" class="card">
      <header class="section-head">
        <h2>Skills</h2>
      </header>
      <div class="section-body">
  <label>Team</label>
  <select id="skillsTeam"></select>
  <label>Opponent</label>
  <select id="skillsOpponent"></select>
        <label>Improve (e.g. 5% or 0.05)</label>
        <input id="skillsImprove" placeholder="5%" />
        <div class="btn-group">
          <button onclick="skillsAnalysis()" class="btn"><svg class="icon" aria-hidden="true"><use href="#icon-analyze"/></svg><span>Analyze</span></button>
          <button onclick="skillsQuick()" class="btn btn--secondary" title="Quick"><svg class="icon" aria-hidden="true"><use href="#icon-bolt"/></svg><span>Quick</span></button>
          <button onclick="skillsAccurate()" class="btn btn--purple" title="Accurate"><svg class="icon" aria-hidden="true"><use href="#icon-target"/></svg><span>Accurate</span></button>
        </div>
        <div id="skillsStatus" class="status"></div>
      </div>
    </section>

    <section id="compare" class="card">
      <header class="section-head">
        <h2>Compare</h2>
      </header>
      <div class="section-body">
        <label>Teams (comma separated)</label>
        <input id="compareTeams" placeholder="team_a.yaml,team_b.yaml" />
        <div class="btn-group">
          <button onclick="compareTeamsRun()" class="btn"><svg class="icon" aria-hidden="true"><use href="#icon-compare"/></svg><span>Compare</span></button>
          <button onclick="compareQuick()" class="btn btn--secondary" title="Quick"><svg class="icon" aria-hidden="true"><use href="#icon-bolt"/></svg><span>Quick</span></button>
          <button onclick="compareAccurate()" class="btn btn--purple" title="Accurate"><svg class="icon" aria-hidden="true"><use href="#icon-target"/></svg><span>Accurate</span></button>
        </div>
      </div>
    </section>

    <section id="examplesSection" class="card">
      <header class="section-head">
        <h2>Rallies</h2>
      </header>
      <div class="section-body">
        <div class="examples-inline">
          <div><label>Team A</label><select id="exTeamA"></select></div>
          <div><label>Team B</label><select id="exTeamB"></select></div>
          <div><label>Count</label><input id="exCount" type="number" value="5" /></div>
          <div style="display:flex;align-items:flex-end"><button onclick="runExamples()" class="btn"><svg class="icon" aria-hidden="true"><use href="#icon-rally"/></svg><span>Generate</span></button></div>
        </div>
        <div class="note">Generates short rally descriptions for quick inspection.</div>
      </div>
    </section>
  </div>

  <div id="layoutOutputs">
    <section id="confidenceChartSection">
      <h2 id="chartPaneTitle">Output</h2>
      <p class="muted">Visualizes skills impact (CI), simulation win rates, or comparison rankings.</p>
  <!-- Rallies visualization container (now positioned at top) -->
  <div id="ralliesContainer"></div>
  <div id="ralliesLegend"></div>
      <canvas id="matchImpactChart" height="260" style="max-height:640px;width:100%;"></canvas>
      <div id="matchImpactLegend" style="display:flex;flex-wrap:wrap;margin-top:4px"></div>
      <div id="matchImpactTableContainer"></div>
      <div id="matchImpactStatus" class="status"></div>
    </section>
    <section id="textOutputSection">
      <h2>JSON Output</h2>
      <div id="output"></div>
    </section>
  </div>
</main>
<!-- Modal Editor -->
<div id="teamEditorModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(13,25,38,0.55);z-index:500;">
  <div style="background:#fff; width:clamp(300px,80%,860px); max-height:85vh; display:flex; flex-direction:column; border-radius:12px; box-shadow:0 6px 18px -4px rgba(0,0,0,.3); border:1px solid #0d47a1;">
    <div style="padding:10px 14px; display:flex; align-items:center; justify-content:space-between; background:linear-gradient(90deg,#0d47a1,#1669c1); color:#fff; border-top-left-radius:12px; border-top-right-radius:12px;">
      <strong style="font-size:.75rem; letter-spacing:.5px;">Edit Team YAML</strong>
  <button type="button" onclick="closeTeamModal()" class="btn btn--ghost btn--sm"><svg class="icon" aria-hidden="true"><use href="#icon-close"/></svg><span>Close</span></button>
    </div>
    <div style="padding:12px 14px; display:flex; flex-direction:column; gap:8px; overflow:auto;">
      <div style="font-size:.7rem; color:#3a5164; display:flex; justify-content:space-between; flex-wrap:wrap; gap:6px; align-items:center;">
        <span id="teamEditorFilename" style="font-weight:700; color:#0d305f; font-size:.78rem;"></span>
        <span id="teamEditStatus" class="status" style="margin:0; font-size:.66rem;"></span>
      </div>
      <textarea id="teamEditor" style="flex:1 1 auto; min-height:300px; font-family:ui-monospace,monospace; font-size:.65rem; line-height:1.25; background:#0e1116; color:#d1d9e6; border:1px solid #1e2d3e; border-radius:8px; padding:10px; resize:vertical;" spellcheck="false"></textarea>
  <div style="display:flex; gap:8px; flex-wrap:wrap;">
  <button type="button" onclick="saveTeamEdit()" class="btn btn--success"><svg class="icon" aria-hidden="true"><use href="#icon-save"/></svg><span>Save</span></button>
  <button type="button" class="btn btn--secondary" onclick="downloadCurrentTeam()"><svg class="icon" aria-hidden="true"><use href="#icon-download"/></svg><span>Download</span></button>
  <button type="button" class="btn btn--secondary" onclick="formatTeamYaml()"><svg class="icon" aria-hidden="true"><use href="#icon-format"/></svg><span>Format</span></button>
      </div>
  <ul id="teamEditErrors" style="list-style:disc; margin:4px 0 0 18px; padding:0; font-size:.62rem; color:#b71c1c; display:none;"></ul>
      <div class="note" style="margin-top:2px;">Changes are validated server-side; ensure required fields remain intact.</div>
    </div>
  </div>
</div>
<footer>
  BVSim Web MVP - Generated interface. Edit YAML files directly to fine-tune probabilities.
</footer>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="/static/app.js"></script>
<script>
let controlsCollapsed = false;
function toggleAllControls(){
  controlsCollapsed = !controlsCollapsed;
  const cards = document.querySelectorAll('#controls section.card');
  cards.forEach(card => {
    if(controlsCollapsed) card.classList.add('collapsed'); else card.classList.remove('collapsed');
  });
  const btn = document.getElementById('globalToggleControls');
  if(btn) {
    btn.innerHTML = controlsCollapsed 
      ? `<svg class="icon" aria-hidden="true"><use href="#icon-expand"/></svg><span class="btn-label">Expand</span>`
      : `<svg class="icon" aria-hidden="true"><use href="#icon-collapse"/></svg><span class="btn-label">Collapse</span>`;
  }
}
</script>
</body>
</html>
